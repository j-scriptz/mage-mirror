services:
  db:
    command:
      - mysqld
      - --max_allowed_packet=1024M
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
      - --default-authentication-plugin=mysql_native_password

      - --innodb_buffer_pool_size=2G
      - --innodb_buffer_pool_instances=4
      - --innodb_log_buffer_size=256M
      - --innodb_log_file_size=1G

      - --innodb_read_io_threads=16
      - --innodb_write_io_threads=16
      - --innodb_io_capacity=2000
      - --innodb_io_capacity_max=4000
      - --innodb_flush_log_at_trx_commit=2
      - --innodb_flush_method=O_DIRECT

      - --tmp_table_size=128M # bump to 256 if you have the ram
      - --max_heap_table_size=128M # bump to 256 if you have the ram
      - --table_open_cache=4000
      - --table_definition_cache=2000

      - --slow_query_log=1 #warden env exec -T db tail -f /var/lib/mysql/*-slow.log
      - --long_query_time=1
      - --log_output=FILE
      - --innodb_print_all_deadlocks=ON

  php-fpm:
    volumes:
      - ./.warden/php/zz-config.ini:/etc/php.d/zz-config.ini
  php-debug:
    volumes:
      - ./.warden/php/zz-config.ini:/etc/php.d/zz-config.ini
  nginx:
    volumes:
      - ./.warden/nginx/custom.conf:/etc/nginx/conf.d/custom.conf:ro
